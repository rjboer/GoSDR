<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>GoSDR Telemetry</title>
  <link rel="stylesheet" href="/static/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <header class="page-header">
    <div>
      <h1>GoSDR Monopulse Tracker</h1>
      <p>Live steering angle and peak telemetry</p>
    </div>
    <nav class="top-nav" aria-label="Primary">
      <a class="active" href="/">Telemetry</a>
      <a href="/settings">Settings</a>
    </nav>
  </header>
  <main>
    <div class="tab-header" role="tablist" aria-label="Telemetry views">
      <button class="tab-button active" role="tab" aria-selected="true" aria-controls="introduction"
        data-tab="introduction">Introduction</button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="telemetry"
        data-tab="telemetry">Telemetry</button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="trace" data-tab="trace">Trace</button>
      <button class="tab-button" role="tab" aria-selected="false" aria-controls="debug" data-tab="debug">Debug</button>

    </div>

        <section id="introduction" class="tab-panel active" role="tabpanel" aria-label="Introduction">
      <div class="introduction-content" style="max-width: 900px; margin: 0 auto; padding: 2rem;">
        <h1 style="color: #2f80ed; margin-bottom: 1rem;">GoSDR Monopulse Direction Finder</h1>
        
        <div style="margin-bottom: 2rem;">
          <h2 style="color: #cbd5e1; border-bottom: 2px solid #1f2a3a; padding-bottom: 0.5rem;">?? Overview</h2>
          <p style="color: #9fb3c8; line-height: 1.6;">
            GoSDR is a real-time direction finding system using monopulse angle-of-arrival estimation. 
            It processes IQ samples from a two-channel SDR to determine the bearing of RF signals with high precision.
          </p>
        </div>

        <div style="margin-bottom: 2rem;">
          <h2 style="color: #cbd5e1; border-bottom: 2px solid #1f2a3a; padding-bottom: 0.5rem;">?? Key Features</h2>
          <ul style="color: #9fb3c8; line-height: 1.8;">
            <li><strong style="color: #cbd5e1;">Multi-Target Tracking:</strong> Simultaneously track up to 256 targets with independent lifecycles</li>
            <li><strong style="color: #cbd5e1;">Real-Time Processing:</strong> Sub-millisecond tracking updates with optimized DSP pipeline</li>
            <li><strong style="color: #cbd5e1;">Monopulse Estimation:</strong> High-accuracy angle determination using phase comparison</li>
            <li><strong style="color: #cbd5e1;">Interactive Web UI:</strong> Live radar display, charts, and comprehensive diagnostics</li>
            <li><strong style="color: #cbd5e1;">MockSDR Support:</strong> Test and experiment without hardware using simulated signals</li>
          </ul>
        </div>

        <div style="margin-bottom: 2rem;">
          <h2 style="color: #cbd5e1; border-bottom: 2px solid #1f2a3a; padding-bottom: 0.5rem;">?? Quick Start</h2>
          <ol style="color: #9fb3c8; line-height: 1.8;">
            <li><strong style="color: #cbd5e1;">Configure Settings:</strong> Visit the <a href="/settings" style="color: #2f80ed;">Settings Page</a> to adjust RF parameters, tracking mode, and SDR backend</li>
            <li><strong style="color: #cbd5e1;">Choose Tracking Mode:</strong>
              <ul style="margin-top: 0.5rem;">
                <li><strong>Single:</strong> Track the strongest target (classic mode)</li>
                <li><strong>Multi:</strong> Track multiple targets simultaneously</li>
              </ul>
            </li>
            <li><strong style="color: #cbd5e1;">Monitor Telemetry:</strong> Switch to the <strong>Telemetry</strong> tab to view live tracking data</li>
            <li><strong style="color: #cbd5e1;">Debug Performance:</strong> Use the <strong>Debug</strong> tab for system metrics and diagnostics</li>
          </ol>
        </div>

        <div style="margin-bottom: 2rem;">
          <h2 style="color: #cbd5e1; border-bottom: 2px solid #1f2a3a; padding-bottom: 0.5rem;">?? Navigation</h2>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
            <div style="background: #121926; border: 1px solid #1f2a3a; border-radius: 8px; padding: 1rem;">
              <h3 style="color: #2f80ed; margin: 0 0 0.5rem 0;">Telemetry</h3>
              <p style="color: #9fb3c8; font-size: 0.9rem; margin: 0;">Real-time radar display, angle charts, track statistics, and signal quality metrics</p>
            </div>
            <div style="background: #121926; border: 1px solid #1f2a3a; border-radius: 8px; padding: 1rem;">
              <h3 style="color: #2f80ed; margin: 0 0 0.5rem 0;">Trace</h3>
              <p style="color: #9fb3c8; font-size: 0.9rem; margin: 0;">Detailed spectrum analysis and frequency-domain visualization</p>
            </div>
            <div style="background: #121926; border: 1px solid #1f2a3a; border-radius: 8px; padding: 1rem;">
              <h3 style="color: #2f80ed; margin: 0 0 0.5rem 0;">Debug</h3>
              <p style="color: #9fb3c8; font-size: 0.9rem; margin: 0;">System diagnostics, CPU/memory usage, goroutine monitoring, and event logs</p>
            </div>
            <div style="background: #121926; border: 1px solid #1f2a3a; border-radius: 8px; padding: 1rem;">
              <h3 style="color: #cbd5e1; margin: 0 0 0.5rem 0;">Settings</h3>
              <p style="color: #9fb3c8; font-size: 0.9rem; margin: 0;">Configure RF parameters, tracking modes, SDR backend, and MockSDR controls</p>
            </div>
          </div>
        </div>

        <div style="margin-bottom: 2rem;">
          <h2 style="color: #cbd5e1; border-bottom: 2px solid #1f2a3a; padding-bottom: 0.5rem;">?? MockSDR Interactive Control</h2>
          <p style="color: #9fb3c8; line-height: 1.6;">
            When using the MockSDR backend, you can dynamically adjust the simulated angle in real-time:
          </p>
          <ol style="color: #9fb3c8; line-height: 1.8;">
            <li>Go to <a href="/settings" style="color: #2f80ed;">Settings</a> ? <strong>MockSDR Live Control</strong></li>
            <li>Use the slider to change the simulated phase delta from -90° to +90°</li>
            <li>Watch the radar display update in real-time as the target moves</li>
          </ol>
          <p style="background: rgba(47, 128, 237, 0.1); border-left: 3px solid #2f80ed; padding: 0.75rem; color: #cbd5e1; margin-top: 1rem;">
            ?? <strong>Tip:</strong> Perfect for testing multi-target tracking without hardware!
          </p>
        </div>

        <div style="margin-bottom: 2rem;">
          <h2 style="color: #cbd5e1; border-bottom: 2px solid #1f2a3a; padding-bottom: 0.5rem;">?? System Architecture</h2>
          <p style="color: #9fb3c8; line-height: 1.8;">
            <strong style="color: #cbd5e1;">DSP Pipeline:</strong> FFT ? Peak Detection ? Monopulse Tracking ? Track Association<br>
            <strong style="color: #cbd5e1;">Tracking Modes:</strong> Single-target (highest SNR) or Multi-target (up to max-tracks)<br>
            <strong style="color: #cbd5e1;">Track Lifecycle:</strong> Tentative ? Confirmed ? Lost (with configurable timeout)<br>
            <strong style="color: #cbd5e1;">Web Interface:</strong> Server-Sent Events (SSE) for live updates, REST API for configuration
          </p>
        </div>

        <div style="background: linear-gradient(135deg, rgba(47, 128, 237, 0.1), rgba(52, 211, 153, 0.1)); border: 1px solid #1f2a3a; border-radius: 8px; padding: 1.5rem; text-align: center;">
          <p style="color: #cbd5e1; font-size: 1.1rem; margin: 0;">
            Ready to start? Visit the <a href="/settings" style="color: #2f80ed; font-weight: 600;">Settings Page</a> to configure your system, then switch to the <strong>Telemetry</strong> tab to begin tracking!
          </p>
        </div>
      </div>
    </section>

    <section id="telemetry" class="tab-panel" role="tabpanel" aria-label="Telemetry charts">
      <div class="chart-grid">
        <div class="chart-panel radar-panel">
          <h2>Radar Display</h2>
          <canvas id="radarCanvas" width="400" height="250" aria-label="Radar display"></canvas>
          <div class="radar-info">
            <span id="radarAngle">Angle: --</span>
          </div>
        </div>
        <div class="chart-panel">
          <h2>Steering Angle</h2>
          <canvas id="angleChart" aria-label="Angle chart"></canvas>
        </div>
        <div class="chart-panel">
          <h2>Peak Level</h2>
          <canvas id="peakChart" aria-label="Peak chart"></canvas>
        </div>
        <div class="chart-panel">
          <h2>SNR</h2>
          <canvas id="snrChart" aria-label="SNR chart"></canvas>
        </div>
        <div class="chart-panel">
          <h2>Tracking Confidence</h2>
          <canvas id="confidenceChart" aria-label="Confidence chart"></canvas>
        </div>
      </div>
      <div class="info-grid">
        <div class="chart-panel tracks-panel">
          <div class="tracks-header">
            <div>
              <h2>Tracks</h2>
              <p class="muted">Live detections with state-aware colors</p>
            </div>
            <div class="tracks-controls" aria-label="Track filters">
              <input id="trackFilter" type="search" placeholder="Filter by ID" aria-label="Filter tracks by ID" />
              <select id="trackStateFilter" aria-label="Filter tracks by state">
                <option value="">Any state</option>
                <option value="locked">Locked</option>
                <option value="tracking">Tracking</option>
                <option value="searching">Searching</option>
              </select>
            </div>
          </div>
          <div class="tracks-table" role="table" aria-label="Track list">
            <div class="tracks-row tracks-header-row" role="row">
              <button type="button" data-track-sort="id">ID</button>
              <button type="button" data-track-sort="angleDeg">Angle</button>
              <button type="button" data-track-sort="snr">SNR</button>
              <button type="button" data-track-sort="confidence">Confidence</button>
              <button type="button" data-track-sort="lockState">State</button>
              <button type="button" data-track-sort="ageSeconds">Age</button>
            </div>
            <div id="tracksTableBody" class="tracks-body" role="rowgroup"></div>
          </div>
        </div>
        <div class="chart-panel summary-panel">
          <h2>Settings Summary</h2>
          <div class="summary-grid">
            <div class="summary-card">
              <p class="muted">SDR backend</p>
              <div id="summaryBackend" class="metric-value">--</div>
            </div>
            <div class="summary-card">
              <p class="muted">RX LO</p>
              <div id="summaryRxLo" class="metric-value">--</div>
            </div>
            <div class="summary-card">
              <p class="muted">Tone offset</p>
              <div id="summaryToneOffset" class="metric-value">--</div>
            </div>
            <div class="summary-card">
              <p class="muted">Sample rate</p>
              <div id="summarySampleRate" class="metric-value">--</div>
            </div>
            <div class="summary-card">
              <p class="muted">FFT size</p>
              <div id="summaryFftSize" class="metric-value">--</div>
            </div>
            <div class="summary-card">
              <p class="muted">Tracking mode</p>
              <div id="summaryTrackingMode" class="metric-value">--</div>
            </div>
            <div class="summary-card">
              <p class="muted">Max tracks</p>
              <div id="summaryMaxTracks" class="metric-value">--</div>
            </div>
            <div class="summary-card">
              <p class="muted">Track timeout</p>
              <div id="summaryTimeout" class="metric-value">--</div>
            </div>
            <div class="summary-card">
              <p class="muted">SNR threshold</p>
              <div id="summarySnrThreshold" class="metric-value">--</div>
            </div>
          </div>
        </div>
        <div class="chart-panel stats-panel">
          <h2>Live Statistics</h2>
          <div class="stats-grid">
            <div class="stat-group">
              <div class="stat-heading">Angle (deg)</div>
              <div class="stat-cards">
                <div class="summary-card">
                  <p class="muted">Avg</p>
                  <div id="angleAvg" class="metric-value">--</div>
                </div>
                <div class="summary-card">
                  <p class="muted">Std dev</p>
                  <div id="angleStd" class="metric-value">--</div>
                </div>
                <div class="summary-card">
                  <p class="muted">Min</p>
                  <div id="angleMin" class="metric-value">--</div>
                </div>
                <div class="summary-card">
                  <p class="muted">Max</p>
                  <div id="angleMax" class="metric-value">--</div>
                </div>
              </div>
            </div>
            <div class="stat-group">
              <div class="stat-heading">Peak (dBFS)</div>
              <div class="stat-cards">
                <div class="summary-card">
                  <p class="muted">Avg</p>
                  <div id="peakAvg" class="metric-value">--</div>
                </div>
                <div class="summary-card">
                  <p class="muted">Std dev</p>
                  <div id="peakStd" class="metric-value">--</div>
                </div>
                <div class="summary-card">
                  <p class="muted">Min</p>
                  <div id="peakMin" class="metric-value">--</div>
                </div>
                <div class="summary-card">
                  <p class="muted">Max</p>
                  <div id="peakMax" class="metric-value">--</div>
                </div>
              </div>
            </div>
          </div>
          <div class="update-rate">
            <p class="muted">Update rate</p>
            <div id="updateRate" class="metric-value">--</div>
          </div>
        </div>
        <div class="chart-panel track-stats-panel">
          <h2>Track Statistics</h2>
          <p class="muted">Rolling averages per tracked ID</p>
          <div id="trackStatsContainer" class="track-stats-container"></div>
        </div>

        <!-- New cluster for SNR / Confidence / Lock -->
        <div class="chart-panel quality-panel">
          <h2>Signal Quality</h2>
          <div class="summary-grid">
            <div class="summary-card">
              <p class="muted">SNR</p>
              <div id="snrValue" class="metric-value">-- dB</div>
            </div>
            <div class="summary-card">
              <p class="muted">Confidence</p>
              <div id="confidenceValue" class="metric-value">--%</div>
            </div>
            <div class="summary-card">
              <p class="muted">Lock</p>
              <div id="lockBadge" class="lock-badge">searching</div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="trace" class="tab-panel" role="tabpanel" aria-label="Trace view">
      <div class="chart-panel trace-panel">
        <div class="trace-header">
          <div>
            <h2>Trace</h2>
            <p class="muted">Live telemetry samples with export options</p>
          </div>
          <div class="trace-meta">
            <span id="traceCount" class="metric-value">0 / 500</span>
            <span id="traceStatus" class="trace-status-badge">live</span>
          </div>
        </div>
        <div class="trace-controls" role="group" aria-label="Trace controls">
          <div class="trace-actions">
            <button id="tracePauseBtn" class="secondary-btn" type="button">Pause</button>
            <button id="traceClearBtn" class="secondary-btn" type="button">Clear history</button>
          </div>
          <div class="trace-export" aria-label="Trace export controls">
            <label for="traceExportFormat" class="muted">Export as</label>
            <select id="traceExportFormat" aria-label="Trace export format">
              <option value="csv">CSV</option>
              <option value="json">JSON</option>
            </select>
            <button id="traceCopyBtn" class="secondary-btn" type="button">Copy</button>
            <button id="traceDownloadBtn" class="primary-btn" type="button">Download</button>
          </div>
        </div>
        <div class="trace-table" aria-live="polite">
          <div class="trace-table-header">
            <div>Timestamp</div>
            <div>Angle (deg)</div>
            <div>Peak (dBFS)</div>
          </div>
          <div class="trace-table-body" id="traceViewport">
            <div id="traceVirtualList" class="trace-virtual-list" role="rowgroup"></div>
          </div>
        </div>
      </div>
    </section>
    <section id="debug" class="tab-panel" role="tabpanel" aria-label="Debug view">
      <div class="debug-panel" aria-live="polite">
        <div class="debug-header">
          <div>
            <h2>Debug telemetry</h2>
            <p id="debugStatus" class="muted">Waiting for diagnosticsâ€¦</p>
          </div>
          <div class="health-summary">
            <span id="healthStatusBadge" class="status-badge">--</span>
            <span class="muted">Version <span id="diagVersion">--</span></span>
          </div>
        </div>
        <div class="debug-sections">
          <div class="debug-section">
            <div class="debug-section-header">
              <h3>System Status</h3>
              <span class="muted" id="debugLastUpdated">--</span>
            </div>
            <div class="debug-grid">
              <div class="debug-card">
                <h4>Uptime</h4>
                <div class="debug-value" id="diagUptime">--</div>
                <p class="muted">Started at <span id="diagStartTime">--</span></p>
              </div>
              <div class="debug-card">
                <h4>Samples</h4>
                <div class="debug-value" id="diagSamples">--</div>
                <p class="muted">Last sample <span id="diagLastSample">--</span></p>
              </div>
              <div class="debug-card">
                <h4>Update rate</h4>
                <div class="debug-value" id="diagUpdateRate">--</div>
                <p class="muted">avg samples/sec</p>
              </div>
            </div>
          </div>
          <div class="debug-section">
            <div class="debug-section-header">
              <h3>Health Checks</h3>
              <span class="muted" id="healthReason">--</span>
            </div>
            <div id="healthChecks" class="health-checks"></div>
          </div>
          <div class="debug-section">
            <div class="debug-section-header">
              <h3>Performance</h3>
            </div>
            <div class="debug-grid">
              <div class="debug-card">
                <div class="debug-card-header">
                  <h4>CPU load</h4>
                  <span class="status-badge" id="cpuStatusBadge">--</span>
                </div>
                <div class="debug-value" id="diagCpuLoad">--</div>
                <p class="muted">recent process usage</p>
              </div>
              <div class="debug-card">
                <div class="debug-card-header">
                  <h4>Memory</h4>
                  <span class="status-badge" id="memoryStatusBadge">--</span>
                </div>
                <div class="debug-value" id="diagMemAlloc">--</div>
                <p class="muted">RSS <span id="diagMemRss">--</span></p>
                <p class="muted">Total reserved <span id="diagMemSys">--</span></p>
              </div>
              <div class="debug-card">
                <div class="debug-card-header">
                  <h4>Goroutines</h4>
                  <span class="status-badge" id="goroutineStatusBadge">--</span>
                </div>
                <div class="debug-value" id="diagGoroutines">--</div>
                <p class="muted">Iteration <span id="diagIterationTime">--</span></p>
              </div>
              <div class="debug-card">
                <div class="debug-card-header">
                  <h4>Threads</h4>
                  <span class="status-badge" id="threadStatusBadge">--</span>
                </div>
                <div class="debug-value" id="diagThreads">--</div>
                <p class="muted">OS threads in use</p>
              </div>
            </div>
          </div>
          <div class="debug-section">
            <div class="debug-section-header">
              <h3>Signal Quality</h3>
            </div>
            <div class="debug-grid">
              <div class="debug-card">
                <h4>SNR</h4>
                <div class="debug-value" id="diagSNR">--</div>
                <p class="muted">Noise floor <span id="diagNoiseFloor">--</span></p>
              </div>
              <div class="debug-card">
                <h4>Confidence</h4>
                <div class="debug-value" id="diagConfidence">--</div>
                <p class="muted">Lock <span class="lock-badge" id="diagLockState">--</span></p>
              </div>
            </div>
          </div>
          <div class="debug-section">
            <div class="debug-section-header">
              <h3>Debug Info</h3>
            </div>
            <div class="debug-grid">
              <div class="debug-card">
                <h4>Phase delay</h4>
                <div class="debug-value" id="debugPhaseDelay">--</div>
                <p class="muted">Monopulse phase <span id="debugMonopulsePhase">--</span></p>
              </div>
              <div class="debug-card">
                <h4>Peak</h4>
                <div class="debug-value" id="debugPeakValue">--</div>
                <p class="muted">Bin <span id="debugPeakBin">--</span> in band <span id="debugPeakBand">--</span></p>
              </div>
            </div>
          </div>
          <div class="debug-section">
            <div class="debug-section-header">
              <h3>Event Log</h3>
              <span class="muted">Latest 100 events</span>
            </div>
            <div class="event-log">
              <div class="event-log-header">
                <span>Time</span>
                <span>Level</span>
                <span>Message</span>
              </div>
              <div class="event-log-body" id="eventLog"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>
  <script src="/static/app.js"></script>
</body>

</html>