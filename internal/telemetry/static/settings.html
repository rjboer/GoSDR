<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>GoSDR Settings</title>
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="stylesheet" href="/static/settings.css" />
</head>

<body>
  <header class="page-header">
    <div>
      <h1>GoSDR Settings</h1>
      <p>Configure RF, timing, and SDR backend parameters</p>
    </div>
    <nav class="top-nav" aria-label="Primary">
      <a href="/">Telemetry</a>
      <a class="active" href="/settings">Settings</a>
    </nav>
  </header>

  <main class="settings-page">
    <div id="restartBanner" class="info-banner hidden" role="status" aria-live="polite">
      <strong>Restart required for SDR changes.</strong>
      <span>Restart the GoSDR service to apply backend updates.</span>
    </div>

    <form id="configForm" class="settings-form">
      <section class="card">
        <div class="section-heading">
          <h2>RF</h2>
          <p>Front-end and signal parameters</p>
        </div>
        <div class="field-grid">
          <label class="field" for="sampleRateHz">
            <span>Sample rate (Hz)</span>
            <input id="sampleRateHz" name="sampleRateHz" type="number" min="1000" max="61440000" step="1000" required>
            <small>1 kHz â€“ 61.44 MHz</small>
          </label>
          <label class="field" for="rxLoHz">
            <span>RX LO (Hz)</span>
            <input id="rxLoHz" name="rxLoHz" type="number" min="1" step="1000" required>
            <small>Carrier center frequency</small>
          </label>
          <label class="field" for="toneOffsetHz">
            <span>Tone offset (Hz)</span>
            <input id="toneOffsetHz" name="toneOffsetHz" type="number" min="-10000000" max="10000000" step="1000" required>
            <small>Offset from LO for the transmitted tone</small>
          </label>
          <label class="field" for="spacingWavelength">
            <span>Spacing (wavelengths)</span>
            <input id="spacingWavelength" name="spacingWavelength" type="number" min="0.1" max="2" step="0.05" required>
            <small>Antenna spacing in wavelengths</small>
          </label>
          <label class="field" for="rxGain0">
            <span>RX gain ch0 (dB)</span>
            <input id="rxGain0" name="rxGain0" type="number" step="1">
          </label>
          <label class="field" for="rxGain1">
            <span>RX gain ch1 (dB)</span>
            <input id="rxGain1" name="rxGain1" type="number" step="1">
          </label>
          <label class="field" for="txGain">
            <span>TX gain (dB)</span>
            <input id="txGain" name="txGain" type="number" step="1">
          </label>
        </div>
      </section>

      <section class="card">
        <div class="section-heading">
          <h2>Timing & buffering</h2>
          <p>Capture windows and history retention</p>
        </div>
        <div class="field-grid">
          <label class="field" for="numSamples">
            <span>FFT size (samples)</span>
            <input id="numSamples" name="numSamples" type="number" min="64" max="1048576" step="64" required>
            <small>Power-of-two sample window</small>
          </label>
          <label class="field" for="bufferSize">
            <span>Buffer size</span>
            <input id="bufferSize" name="bufferSize" type="number" min="64" max="1048576" step="64" required>
            <small>Power-of-two streaming buffer</small>
          </label>
          <label class="field" for="warmupBuffers">
            <span>Warmup buffers</span>
            <input id="warmupBuffers" name="warmupBuffers" type="number" min="0" max="100" step="1" required>
            <small>Discarded buffers before tracking</small>
          </label>
          <label class="field" for="historyLimit">
            <span>History limit</span>
            <input id="historyLimit" name="historyLimit" type="number" min="1" max="10000" step="1" required>
            <small>Telemetry samples retained</small>
          </label>
        </div>
      </section>

      <section class="card">
        <div class="section-heading">
          <h2>Tracking</h2>
          <p>Monopulse scan and loop parameters</p>
        </div>
        <div class="field-grid">
          <label class="field" for="trackingLength">
            <span>Tracking iterations</span>
            <input id="trackingLength" name="trackingLength" type="number" min="1" max="10000" step="1" required>
            <small>Loop iterations to run</small>
          </label>
          <label class="field" for="trackingMode">
            <span>Tracking mode</span>
            <select id="trackingMode" name="trackingMode">
              <option value="single">Single</option>
              <option value="multi">Multi</option>
            </select>
            <small>Single target or multi-target tracking.</small>
          </label>
          <label class="field" for="maxTracks">
            <span>Max tracks</span>
            <input id="maxTracks" name="maxTracks" type="number" min="1" max="256" step="1" required>
            <small>Maximum concurrent targets.</small>
          </label>
          <label class="field" for="trackTimeoutMs">
            <span>Track timeout (ms)</span>
            <input id="trackTimeoutMs" name="trackTimeoutMs" type="number" min="100" max="120000" step="100" required>
            <small>Age before inactive tracks expire.</small>
          </label>
          <label class="field" for="snrThreshold">
            <span>SNR threshold (dB)</span>
            <input id="snrThreshold" name="snrThreshold" type="number" step="0.5" required>
            <small>Minimum SNR to promote a track.</small>
          </label>
          <label class="field" for="phaseStepDeg">
            <span>Phase step (deg)</span>
            <input id="phaseStepDeg" name="phaseStepDeg" type="number" min="0.01" max="90" step="0.1" required>
          </label>
          <label class="field" for="scanStepDeg">
            <span>Scan step (deg)</span>
            <input id="scanStepDeg" name="scanStepDeg" type="number" min="0.01" max="90" step="0.1" required>
          </label>
          <label class="field" for="phaseCalDeg">
            <span>Phase calibration (deg)</span>
            <input id="phaseCalDeg" name="phaseCalDeg" type="number" step="0.1" required>
          </label>
          <label class="field" for="phaseDeltaDeg">
            <span>Phase delta (deg)</span>
            <input id="phaseDeltaDeg" name="phaseDeltaDeg" type="number" step="0.1" required>
            <small>Initial channel offset estimate</small>
          </label>
        </div>
      </section>

      <section class="card">
        <div class="section-heading">
          <h2>SDR backend</h2>
          <p>Radio selection and connection target</p>
        </div>
        <div class="field-grid">
          <label class="field" for="sdrBackend">
            <span>Backend</span>
            <select id="sdrBackend" name="sdrBackend">
              <option value="mock">Mock</option>
              <option value="pluto">Pluto / AD9361</option>
            </select>
            <small>Choose the simulated mock source or Pluto hardware.</small>
          </label>
          <label class="field" for="sdrUri">
            <span>Backend URI</span>
            <input id="sdrUri" name="sdrUri" type="text" placeholder="ip:192.168.2.1">
            <small>Connection string passed to the backend (disabled for mock).</small>
          </label>
          <label class="field" for="mockPhaseDelta">
            <span>Mock phase delta (deg)</span>
            <input id="mockPhaseDelta" name="mockPhaseDelta" type="number" step="0.1">
            <small>Channel offset simulated by the mock backend.</small>
          </label>
        </div>
      </section>

      <section class="card">
        <div class="section-heading">
          <h2>Logging</h2>
          <p>Control verbosity and output format</p>
        </div>
        <div class="field-grid">
          <label class="field" for="logLevel">
            <span>Log level</span>
            <select id="logLevel" name="logLevel">
              <option value="error">Error</option>
              <option value="warn">Warn</option>
              <option value="info">Info</option>
              <option value="debug">Debug</option>
            </select>
            <small>Lower levels emit more verbose output.</small>
          </label>
          <label class="field" for="logFormat">
            <span>Log format</span>
            <select id="logFormat" name="logFormat">
              <option value="text">Text</option>
              <option value="json">JSON</option>
            </select>
            <small>Choose human-readable text or structured JSON logs.</small>
          </label>
          <label class="field" for="debugMode">
            <span>Debug mode</span>
            <input id="debugMode" name="debugMode" type="checkbox">
            <small>Include DSP internals in telemetry payloads.</small>
          </label>
        </div>
      </section>

      <div class="form-actions">
        <button type="submit">Save changes</button>
        <button type="button" id="resetBtn" class="ghost">Reset to defaults</button>
        <span id="status" class="status hidden" role="status" aria-live="polite"></span>
      </div>
    </form>
  </main>

  <script src="/static/settings.js"></script>
</body>

</html>
